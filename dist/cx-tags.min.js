/*! cxTags v1.1.1 License: MIT */!function(){"use strict";var a={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,comma:188},b=angular.module("cxTags",[]);b.constant("EVENT",{getTags:"get-tags",tagAdded:"tag-added",tagRemoved:"tag-removed",removeTag:"remove-tag",inputChange:"input-change",inputKeyDown:"input-keydown",inputBlur:"input-blur",inputFocus:"input-focus",inputClick:"input-click"}),b.directive("tagsInput",["$document","$rootScope","$timeout","tagsInputConfig","EVENT",function(b,c,d,e,f){function g(a){var b={};return{on:function(a,c){b[a]||(b[a]=[]),b[a].push(c)},trigger:function(d,e){d&&d.length>0&&(a&&a.length>0&&c.$broadcast(a+"."+d,e),angular.forEach(b[d],function(a){a.call(null,e)}))}}}return{restrict:"AE",require:"ngModel",scope:{tags:"=ngModel",onTagAdded:"&",onTagRemoved:"&",messagingNamespace:"@",hideTags:"="},replace:!1,transclude:!0,templateUrl:"cxTags/tags-input.html",controller:["$scope","$attrs","$element",function(a,b,d){var h;e.load("tagsInput",a,b,{customClass:[String],placeholder:[String,"Add a tag"],tabindex:[Number],removeTagSymbol:[String,String.fromCharCode(215)],minLength:[Number,3],maxLength:[Number],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],allowedTagsPattern:[RegExp,/^[\-\_\sa-zA-Z0-9]+$/],enableEditingLastTag:[Boolean,!1],minTags:[Number],maxTags:[Number]}),a.newTag="",a.tags=a.tags||[],a.events=new g(a.messagingNamespace),a.events.on(f.tagAdded,a.onTagAdded),a.events.on(f.tagRemoved,a.onTagRemoved),a.messagingNamespace&&(c.$on(a.messagingNamespace+"."+f.removeTag,function(b,c){a.remove(c)}),c.$on(a.messagingNamespace+"."+f.getTags,function(){a.events.trigger(f.tagAdded,{$tags:a.tags})})),a.tryAdd=function(){var b=!1,c=a.newTag,d=c&&c.label&&angular.isString(c.label)&&c.label.length>=a.options.minLength&&a.options.allowedTagsPattern.test(c.label);return d&&(-1===a.tags.indexOf(c)&&(a.tags.push(c),a.events.trigger(f.tagAdded,{$tag:c,$tags:a.tags})),a.newTag=null,a.events.trigger(f.inputChange,""),b=!0),b},a.tryRemoveLast=function(){var b=!1;return a.tags.length>0&&(a.options.enableEditingLastTag?a.newTag=a.remove(a.tags.length-1):h?(a.remove(a.tags.length-1),h=!1):h=!0,b=!0),b},a.remove=function(b){var c=a.tags.splice(b,1)[0];return a.events.trigger(f.tagRemoved,{$tag:c,$tags:a.tags}),c},a.$watch(function(){return a.newTag&&a.newTag.label&&a.newTag.label.length>0},function(){h=!1}),a.getCssClass=function(b){var c=b===a.tags.length-1;return h&&c?"selected":""},this.getInputValue=function(){return a.newTag},this.registerAutocomplete=function(){var b=d.find("input");return b.on("keydown",function(b){a.events.trigger(f.inputKeyDown,b)}),b.parent().on("click",function(){a.events.trigger(f.inputClick)}),b.on("focus",function(){a.events.trigger(f.inputFocus)}),a.newTagChange=function(){a.events.trigger(f.inputChange,a.newTag)},{tryAddTag:function(b){return a.newTag=b,a.tryAdd()},focusInput:function(){b[0].focus()},getTags:function(){return a.tags||(a.tags=[]),a.tags},on:function(b,c){return a.events.on(b,c),this}}}}],link:function(c,e,g,h){var i=[a.enter,a.comma,a.space,a.backspace],j=e.find("input");j.on("keydown",function(b){if(!b.isImmediatePropagationStopped||!b.isImmediatePropagationStopped()){var d=b.keyCode,e=b.shiftKey||b.altKey||b.ctrlKey||b.metaKey;e||-1===i.indexOf(d)||(d===a.enter&&c.options.addOnEnter||d===a.comma&&c.options.addOnComma||d===a.space&&c.options.addOnSpace?(c.tryAdd()&&c.$apply(),b.preventDefault()):d===a.backspace&&0===this.value.length&&c.tryRemoveLast()&&(c.$apply(),b.preventDefault()))}}).on("focus",function(){c.hasFocus||(c.hasFocus=!0,c.$apply())}).on("blur",function(){d(function(){var a=angular.element(b[0].activeElement).parent();a[0]!==e[0]&&(c.hasFocus=!1,c.options.addOnBlur&&c.tryAdd(),c.events.trigger(f.inputBlur),c.$apply())},0,!1)}),e.find("div").on("click",function(){j[0].focus()}),c.$watch("tags.length",function(){h.$setValidity("maxTags",angular.isUndefined(c.options.maxTags)||c.tags.length<=c.options.maxTags),h.$setValidity("minTags",angular.isUndefined(c.options.minTags)||c.tags.length>=c.options.minTags)})}}}]),b.directive("cxTagList",["$rootScope","$timeout","EVENT",function(a,b,c){var d=function(d){var e=function(a,b){d.tagList=b.$tags};d.tags&&(d.tagList=d.tags),d.messagingNamespace&&d.messagingNamespace.length>0&&(b(function(){a.$broadcast(d.messagingNamespace+"."+c.getTags)},50),a.$on(d.messagingNamespace+"."+c.tagAdded,e),a.$on(d.messagingNamespace+"."+c.tagRemoved,e)),d.remove=function(b){a.$broadcast(d.messagingNamespace+"."+c.removeTag,b)}};return{scope:{messagingNamespace:"@",removeEnabled:"=",tags:"="},replace:!0,templateUrl:"cxTags/tag-list.html",link:d}}]),b.directive("autoComplete",["$document","$timeout","$sce","$location","$anchorScroll","tagsInputConfig","EVENT",function(b,c,d,e,f,g,h){function i(a,b,d){var e,f,g,h={};return f=function(a,b){var c=[],d=b.map(function(a){return a.label});return a.forEach(function(a){-1===d.indexOf(a.label)&&c.push(a)}),c},h.reset=function(){g=null,h.items=[],h.visible=!1,h.index=-1,h.selected=null,h.query=null,c.cancel(e)},h.show=function(){h.selected=null,h.visible=!0},h.load=function(i,j,k){return!k&&i.length<d.minLength?void h.reset():(h.query=i,c.cancel(e),void(e=c(function(){var c={keywords:i,families:b},d=a({$query:c});g=d,d.then(function(a){d===g&&(h.items=f(a.data||a,j),h.items.length>0?h.show():h.reset())})},d.debounceDelay,!1)))},h.selectNext=function(){h.index<h.items.length-1&&h.select(++h.index)},h.selectPrior=function(){h.index>0&&h.select(--h.index)},h.select=function(a){h.index=a,h.selected=h.items[a]},h.reset(),h}return{restrict:"AE",require:"^tagsInput",scope:{source:"&",families:"=",loadOnClick:"=",loadOnFocus:"="},templateUrl:"cxTags/auto-complete.html",link:function(c,d,e,f){var j,k,l=[a.enter,a.tab,a.escape,a.up,a.down],m={top:0},n={top:0},o={move:function(a,b){var c=document.getElementById("suggestion-item-"+j.index),e=c?c.offsetHeight:0;m.el=d.find("ul")[0],m.height=m.el.clientHeight,n.el=d.find("div")[0],n.height=n.el.clientHeight,b?m.top-e<-(m.height-n.height)?m.top=-(m.height-n.height+10):m.top-=e:m.top+e>0?m.top=0:m.top+=e,angular.element(m.el).css("top",m.top+"px")},reset:function(){m.top=0,angular.element(m.el).css("top",m.top+"px")}};g.load("autoComplete",c,e,{debounceDelay:[Number,100],minLength:[Number,c.loadOnClick||c.loadOnFocus?0:3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,c.loadOnClick||c.loadOnFocus?1e6:10]}),k=f.registerAutocomplete(),j=new i(c.source,c.families,c.options),c.suggestionList=j,c.addSuggestion=function(){var a=!1;return j.selected&&(k.tryAddTag(j.selected),j.reset(),k.focusInput(),a=!0),a},k.on(h.inputChange,function(a){c.inputValue=a,a?(j.load(a,k.getTags()),o.reset()):(j.reset(),o.reset())}).on(h.inputClick,function(){o.reset(),c.loadOnClick&&j.load("",k.getTags(),!0)}).on(h.inputFocus,function(){o.reset(),c.loadOnFocus&&j.load("",k.getTags(),!0)}).on(h.inputKeyDown,function(b){var d,e;if(-1!==l.indexOf(b.keyCode)){var f=!1;b.stopImmediatePropagation=function(){f=!0,b.stopPropagation()},b.isImmediatePropagationStopped=function(){return f},j.visible&&(d=b.keyCode,e=!1,d===a.down?(o.move(j.index,!0),j.selectNext(),e=!0):d===a.up?(o.move(j.index,!1),j.selectPrior(),e=!0):d===a.escape?(o.reset(),j.reset(),e=!0):(d===a.enter||d===a.tab)&&(e=c.addSuggestion()),e&&(b.preventDefault(),b.stopImmediatePropagation(),c.$apply()))}}).on(h.inputBlur,function(){j.reset()}),b.on("click",function(){j.visible&&(j.reset(),c.$apply())})}}}]).filter("filterAttributes",[function(){return function(a){var b=angular.copy(a);return b.examples&&delete b.examples,a.compassId&&delete b.compassId,b}}]),b.directive("tiTranscludeAppend",function(){return function(a,b,c,d,e){e(function(a){b.append(a)})}}),b.directive("tiAutosize",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e,f;e=angular.element('<span class="tag-input"></span>'),e.css("display","none").css("visibility","hidden").css("width","auto"),b.parent().append(e),f=function(a){var c=a;angular.isString(a)&&0===a.length&&(a=b.attr("placeholder")),e.text(a),e.css("display","");try{b.css("width",e.prop("offsetWidth")+"px")}finally{e.css("display","none")}return c},d.$parsers.unshift(f),d.$formatters.unshift(f)}}}),b.directive("ngTagHighlight",[function(){return{require:"^tagsInput",scope:{ngTagHighlight:"@",tagAttribute:"@"},link:function(a,b,c,d){var e=a.ngTagHighlight,f=d.getInputValue(),g=new RegExp("("+f+")","gi");b.html(e.replace(g,'<span class="highlighted">$1</span>'))}}}]),b.provider("tagsInputConfig",function(){var a={};this.setDefaults=function(b,c){return a[b]=c,this},this.$get=["$interpolate",function(b){var c={};return c[String]=function(a){return a},c[Number]=function(a){return parseInt(a,10)},c[Boolean]=function(a){return"true"===a.toLowerCase()},c[RegExp]=function(a){return new RegExp(a)},{load:function(d,e,f,g){e.options={},angular.forEach(g,function(g,h){var i=f[h]&&b(f[h])(e.$parent),j=c[g[0]],k=function(b){var c=a[d]&&a[d][b];return angular.isDefined(c)?c:g[1]};e.options[h]=i?j(i):k(h)})}}}]}),b.run(["$templateCache",function(a){a.put("cxTags/tags-input.html",'<div class="ngTagsInput ctx-tags" tabindex="-1" ng-class="options.customClass" ti-transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list" ng-if="!hideTags"><li class="tag-item" ng-repeat="tag in tags" ng-class="getCssClass($index)"><span>{{tag.label}}</span> <button type="button" ng-click="remove($index)">{{options.removeTagSymbol}}</button></li></ul><input class="tag-input" id="{{ id }}" placeholder="{{options.placeholder}}" maxlength="{{options.maxLength}}" tabindex="{{options.tabindex}}" ng-model="newTag" ng-change="newTagChange()" ti-autosize=""></div></div>'),a.put("cxTags/auto-complete.html",'<div class="autocomplete" ng-show="suggestionList.visible"><ul class="suggestion-list"><li id="suggestion-item-{{ $index }}" class="suggestion-item" ng-repeat="item in suggestionList.items" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestion()" ng-mouseenter="suggestionList.select($index)"><ul><li class="tag-label" data-ng-tag-highlight="{{ item.label }}"></li><li class="tag-family" data-ng-tag-highlight="{{ item.family }}"></li><li class="tag-description" ng-if="item.description && item.description.length > 0">: <span class="tag-attribute-value" data-ng-tag-highlight="{{ item.description }}"></span></li><li class="attributes"><ul><li ng-repeat="(key, value) in item.attributes | filterAttributes " class="tag-attribute"><span class="tag-attribute-key">{{ key }}</span> <span class="tag-attribute-value" data-ng-tag-highlight="{{ value }}"></span></li></ul></li><li class="tag-examples" ng-if="item.attributes && item.attributes.examples && (item.attributes.examples.length > 0)"><span class="tag-attribute-key">Examples</span> <span class="tag-attribute-value" data-ng-tag-highlight="{{ item.attributes.examples }}"></span></li></ul></li></ul></div>'),a.put("cxTags/tag-list.html",'<span class="cx-tag-list"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList" ng-class="{locked: tag.locked}"><span>{{tag.label}}</span> <button type="button" data-ng-if="removeEnabled && !tag.locked" ng-click="remove($index)">×</button></li></ul></span>')}])}();